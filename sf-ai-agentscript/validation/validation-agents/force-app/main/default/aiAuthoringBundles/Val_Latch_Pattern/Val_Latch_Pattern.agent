# Val_Latch_Pattern - Tests boolean latch pattern for topic re-entry
# Purpose: Verify latch variable pattern works as documented
#
# Tests:
#   ✓ Boolean latch variable initialization
#   ✓ Setting latch to True when entering verification
#   ✓ Checking latch in topic selector for re-entry
#   ✓ Clearing latch when verification completes
#
# SKILL.md Section: Production Gotchas - Latch Variable Pattern

system:
   messages:
      welcome: "Latch pattern validation ready."
      error: "Latch pattern error."
   instructions: "This agent tests the latch variable pattern."

config:
   agent_name: "Val_Latch_Pattern"
   agent_label: "Validation: Latch Pattern"
   description: "Tests boolean latch for topic re-entry"
   default_agent_user: "home_furnishing_agent@00dvz000004evdp1379858245.ext"

variables:
   verification_in_progress: mutable boolean = False
   verified: mutable boolean = False

topic topic_selector:
   description: "Routes based on latch state"
   reasoning:
      instructions: ->
         # LATCH CHECK - force re-entry if verification was started
         if @variables.verification_in_progress == True:
            | Resuming verification...
            transition to @topic.verification

         | How can I help you today?
      actions:
         start_verify: @utils.transition to @topic.verification
            description: "Start identity verification"

topic verification:
   description: "Verification topic with latch management"
   reasoning:
      instructions: ->
         # Set latch when entering
         set @variables.verification_in_progress = True

         | Please provide your email to verify your identity.

         # Simulate verification success
         set @variables.verified = True

         # Clear latch when verification completes
         set @variables.verification_in_progress = False

         | Verification complete!
      actions:
         done: @utils.transition to @topic.done
            description: "Complete verification"
            available when @variables.verified == True

topic done:
   description: "Validation complete"
   reasoning:
      instructions: |
         Latch pattern validation successful.

start_agent entry:
   description: "Entry point"
   reasoning:
      instructions: |
         Start latch pattern validation.
      actions:
         begin: @utils.transition to @topic.topic_selector
            description: "Begin latch tests"
