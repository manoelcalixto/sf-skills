# Val_Loop_Guard - Tests loop protection guardrail pattern
# Purpose: Verify iteration counter pattern works as documented
#
# Tests:
#   ✓ Iteration counter initialization
#   ✓ Counter increment in loop
#   ✓ Exit condition when max iterations reached
#   ✓ Protection against infinite loops
#
# SKILL.md Section: Production Gotchas - Loop Protection Guardrail
# Note: Agent Scripts have a built-in guardrail limiting to ~3-4 loops

system:
   messages:
      welcome: "Loop guard validation ready."
      error: "Loop guard error."
   instructions: "This agent tests loop protection patterns."

config:
   agent_name: "Val_Loop_Guard"
   agent_label: "Validation: Loop Guard"
   description: "Tests iteration protection pattern"
   default_agent_user: "home_furnishing_agent@00dvz000004evdp1379858245.ext"

variables:
   iterations: mutable number = 0
   max_iterations: mutable number = 3

topic loop_test:
   description: "Tests loop with guard"
   reasoning:
      instructions: ->
         # Increment iteration counter
         set @variables.iterations = @variables.iterations + 1

         | Iteration: {!@variables.iterations}

         # Check if max iterations reached
         if @variables.iterations >= @variables.max_iterations:
            | Max iterations reached. Exiting loop.
            transition to @topic.done
      actions:
         continue_loop: @utils.transition to @topic.loop_test
            description: "Continue looping"
            available when @variables.iterations < @variables.max_iterations

         exit_loop: @utils.transition to @topic.done
            description: "Exit loop"

topic done:
   description: "Loop guard validation complete"
   reasoning:
      instructions: ->
         | Loop guard validation successful.
         | Total iterations: {!@variables.iterations}

start_agent entry:
   description: "Entry point"
   reasoning:
      instructions: |
         Start loop guard validation.
      actions:
         begin: @utils.transition to @topic.loop_test
            description: "Begin loop tests"
